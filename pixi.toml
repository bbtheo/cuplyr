[workspace]
name = "cuplyr"
version = "0.0.1"
description = "GPU-accelerated dplyr backend via RAPIDS libcudf"
channels = ["rapidsai", "conda-forge", "nvidia"]
platforms = ["linux-64"]

[dependencies]
# RAPIDS C++ libraries (from conda - includes headers)
libcudf = ">=25.12"
librmm = ">=25.12"
libkvikio = ">=25.12"

# CUDA toolkit
cuda-toolkit = ">=12.0,<13"
cuda-nvcc = ">=12.0,<13"
pandoc = ">=3.0"

[tasks]
configure = { cmd = "./configure", description = "Detect paths, generate Makevars" }
install = { cmd = "R CMD INSTALL .", description = "Install R package" }
test = { cmd = "R -e 'devtools::test(reporter = \"summary\")'", description = "Run tests" }
check = { cmd = "R CMD check --no-manual .", description = "R CMD check" }
clean = { cmd = "rm -f src/*.o src/*.so src/Makevars 2>/dev/null || true", description = "Clean artifacts" }
dev = { cmd = "./configure && R CMD INSTALL .", depends-on = ["clean"], description = "Clean rebuild" }
bench = { cmd = "Rscript inst/benchmarks/run_benchmarks.R", description = "Run benchmarks" }
r = { cmd = "R", description = "Start R with pixi environment" }
load-dev = { cmd = "R -e 'devtools::load_all()'", description = "Load package in dev mode" }
pkgdown = { cmd = "XDG_CACHE_HOME=/tmp Rscript scripts/build_pkgdown.R", description = "Build pkgdown site into docs/" }

[tasks.build]
cmd = "R CMD build ."
depends-on = ["configure"]
description = "Build source tarball"

[tasks.full-check]
cmd = "R CMD build . && R CMD check cuplyr_*.tar.gz --as-cran"
depends-on = ["configure"]
description = "Full CRAN-style check"
