[workspace]
name = "cuplyr"
version = "0.0.1"
description = "GPU-accelerated dplyr backend via RAPIDS libcudf"
channels = ["rapidsai", "conda-forge", "nvidia"]
platforms = ["linux-64"]

[dependencies]
# RAPIDS C++ libraries (from conda - includes headers)
libcudf = ">=25.12"
librmm = ">=25.12"
libkvikio = ">=25.12"

# CUDA toolkit
cuda-toolkit = ">=12.0,<13"
cuda-nvcc = ">=12.0,<13"
pandoc = ">=3.0"

[tasks]
configure = { cmd = "./configure", description = "Detect paths, generate Makevars" }
install = { cmd = "R CMD INSTALL .", depends-on = ["configure"], description = "Configure and install R package" }
test = { cmd = "R -e 'devtools::test(reporter = \"summary\")'", description = "Run tests" }
check = { cmd = "_R_CHECK_FORCE_SUGGESTS_=false R CMD check --no-manual --ignore-vignettes cuplyr_*.tar.gz", depends-on = ["build"], description = "R CMD check (tarball)" }
clean = { cmd = "rm -f src/*.o src/*.so src/Makevars 2>/dev/null || true", description = "Clean artifacts" }
dev = { cmd = "./configure && R CMD INSTALL .", depends-on = ["clean"], description = "Clean rebuild" }
bench = { cmd = "Rscript inst/benchmarks/run_benchmarks.R", description = "Run benchmarks" }
r = { cmd = "R", description = "Start R with pixi environment" }
load-dev = { cmd = "R -e 'devtools::load_all()'", description = "Load package in dev mode" }
check-deps = { cmd = "R -e 'devtools::load_all(); check_deps()'", description = "Check dependencies for cuplyr" }
pkgdown = { cmd = "XDG_CACHE_HOME=/tmp Rscript scripts/build_pkgdown.R", description = "Build pkgdown site into docs/" }

[tasks.build]
cmd = "./scripts/build-tarball.sh"
depends-on = ["configure"]
description = "Build source tarball (excludes .pixi)"

[tasks.full-check]
cmd = "_R_CHECK_FORCE_SUGGESTS_=false R CMD check --no-manual --ignore-vignettes cuplyr_*.tar.gz --as-cran"
depends-on = ["build"]
description = "Full CRAN-style check"
